---
// Main Layout - Character Sheet/Paper Design
import TabNavigation from '../components/TabNavigation.astro';
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
  currentPage: string;
}

const {
  title,
  description = 'An indie tabletop RPG publishing company',
  currentPage
} = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content={description}>
  <meta name="generator" content={Astro.generator}>
  <title>{title}</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <script is:inline>
    // Dark mode initialization - runs before page render to prevent flash
    const theme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', theme);
  </script>
</head>
<body>
  <!-- SVG Filters for hand-drawn effects -->
  <svg class="filters" aria-hidden="true">
    <defs>
      <filter id="pencil-texture">
        <feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="4" result="noise" />
        <feDisplacementMap in="SourceGraphic" in2="noise" scale="2" xChannelSelector="R" yChannelSelector="G" />
      </filter>

      <filter id="paper-texture">
        <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" result="noise" />
        <feDiffuseLighting in="noise" lighting-color="white" surfaceScale="1">
          <feDistantLight azimuth="45" elevation="60" />
        </feDiffuseLighting>
      </filter>

      <filter id="rough-edges">
        <feTurbulence baseFrequency="0.02" numOctaves="5" result="noise" />
        <feDisplacementMap in="SourceGraphic" in2="noise" scale="3" />
      </filter>
    </defs>
  </svg>

  <!-- Tab Navigation -->
  <TabNavigation currentPage={currentPage} />

  <!-- Main Container -->
  <div class="page-container">
    <!-- Floating Paper Sheet -->
    <main class="paper-sheet">
      <!-- Corner fold effect -->
      <div class="corner-fold"></div>

      <!-- Content area -->
      <div class="content">
        <slot />
      </div>
    </main>
  </div>
</body>
</html>

<style>
  .page-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-xl) var(--spacing-md);
    position: relative;
    z-index: 2;
  }

  .paper-sheet {
    position: relative;
    width: 100%;
    max-width: var(--page-max-width);
    min-height: 80vh;
    background: var(--page-bg);
    padding: var(--spacing-xl);
    border-radius: 8px;
    box-shadow:
      0 0 0 1px var(--border-color),
      0 8px 16px var(--shadow),
      0 16px 32px var(--shadow-light);
    transition: background 0.3s ease, box-shadow 0.3s ease;
    animation: fadeIn 0.8s ease-out;
  }

  /* Corner fold effect */
  .corner-fold {
    position: absolute;
    top: 0;
    right: 0;
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 0 40px 40px 0;
    border-color: transparent var(--page-dark) transparent transparent;
    filter: drop-shadow(-2px 2px 3px var(--shadow-light));
    transition: border-color 0.3s ease;
  }

  .corner-fold::before {
    content: '';
    position: absolute;
    top: 0;
    right: -40px;
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 0 40px 40px 0;
    border-color: transparent var(--shadow-light) transparent transparent;
  }

  /* Content area */
  .content {
    position: relative;
    z-index: 1;
    animation: fadeIn 1s ease-out 0.2s both;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .page-container {
      padding: var(--spacing-md) var(--spacing-sm);
      padding-bottom: 80px; /* Space for mobile tabs */
      align-items: flex-start;
    }

    .paper-sheet {
      padding: var(--spacing-md);
      min-height: auto;
    }

    .corner-fold {
      border-width: 0 30px 30px 0;
    }

    .corner-fold::before {
      right: -30px;
      border-width: 0 30px 30px 0;
    }
  }

  @media (max-width: 480px) {
    .paper-sheet {
      padding: var(--spacing-sm);
    }
  }
</style>
